name: Validate Scripts

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate script structure
        run: |
          echo "üîç Validating script structure..."
          
          # Find all scripts
          scripts=$(find . -name "*.sh" -type f | grep -v ".git" || true)
          
          if [ -z "$scripts" ]; then
            echo "‚úÖ No scripts found to validate"
            exit 0
          fi
          
          echo "üìã Found $(echo "$scripts" | wc -l) scripts to validate"
          
          ALL_VALID=true
          
          for script in $scripts; do
            echo "---"
            echo "üîé Validating: $script"
            
            # Check 1: File is executable
            if [ ! -x "$script" ]; then
              echo "‚ùå NOT EXECUTABLE: $script"
              ALL_VALID=false
            fi
            
            # Check 2: Has shebang
            if ! head -1 "$script" | grep -q "#!/bin/bash"; then
              echo "‚ùå MISSING SHEBANG: $script"
              ALL_VALID=false
            fi
            
            # Check 3: Has your template structure
            if ! grep -q "folder_name=\$(basename" "$script"; then
              echo "‚ùå MISSING FOLDER_NAME LOGIC: $script"
              ALL_VALID=false
            fi
            
            # Check 4: Has installer.sh call
            if ! grep -q "BLFS_bmo_os_utils/scripts/installer.sh" "$script"; then
              echo "‚ùå MISSING INSTALLER CALL: $script"
              ALL_VALID=false
            fi
            
            # Check 5: Has basic structure (configure/make/install)
            if ! grep -q "configure" "$script" && ! grep -q "make" "$script"; then
              echo "‚ö†Ô∏è  MISSING BUILD COMMANDS: $script"
            fi
            
            echo "‚úÖ Basic checks passed for: $script"
          done
          
          if [ "$ALL_VALID" = false ]; then
            echo "‚ùå Some scripts failed validation!"
            exit 1
          else
            echo "üéâ All scripts are valid!"
          fi
